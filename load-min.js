/*! Copyright (c) 2010 Chris O'Hara <cohara87@gmail.com>. MIT Licensed */
(function(d,a){(function(f){f=f||{};var e={},h,g;h=function(i,m,l){var k=i.halt=!1;i.error=function(n){throw n},i.next=function(q){q&&(k=!1);if(!i.halt&&m&&m.length){var p=m.shift(),o=p.shift();k=!0;try{e[o].apply(i,[p,p.length,o])}catch(n){i.error(n)}}return i};for(var j in e){if(typeof i[j]==="function"){continue}(function(n){i[n]=function(){var p=Array.prototype.slice.call(arguments);if(n==="onError"){if(m){e.onError.apply(i,[p,p.length]);return i}var o={};e.onError.apply(o,[p,p.length]);return h(o,null,"onError")}p.unshift(n);if(!m){return h({},[p],n)}i.then=i[n],m.push(p);return k?i:i.next()}})(j)}l&&(i.then=i[l]),i.call=function(n,o){o.unshift(n),m.unshift(o),i.next(!0)};return i.next()},g=f.addMethod=function(m){var l=Array.prototype.slice.call(arguments),k=l.pop();for(var j=0,i=l.length;j<i;j++){typeof l[j]==="string"&&(e[l[j]]=k)}--i||(e["then"+m.substr(0,1).toUpperCase()+m.substr(1)]=k),h(f)},g("chain",function(j){var i=this,k=function(){if(!i.halt){if(!j.length){return i.next(!0)}try{null!=j.shift().call(i,k,i.error)&&k()}catch(l){i.error(l)}}};k()}),g("run",function(j,i){var o=this,n=function(){o.halt||--i||o.next(!0)},m=function(p){o.error(p)};for(var l=0,k=i;!o.halt&&l<k;l++){null!=j[l].call(o,n,m)&&n()}}),g("defer",function(j){var i=this;setTimeout(function(){i.next(!0)},j.shift())}),g("onError",function(j,i){var k=this;this.error=function(m){k.halt=!0;for(var l=0;l<i;l++){j[l].call(k,m)}}})})(this);this.addMethod("load",function(f,h){for(var e=[],g=0;g<h;g++){(function(j){e.push(function(k,i){c(f[j],k,i)})}(g))}this.call("run",e)});var b=a.getElementsByTagName("head")[0]||a.documentElement;function c(h,g,e){var f=a.createElement("script");f.type="text/javascript";f.src=h;f.onload=g;f.onerror=e;f.onreadystatechange=function(){var i=this.readyState;if(i==="loaded"||i==="complete"){f.onreadystatechange=null;g()}};b.insertBefore(f,b.firstChild)}d.loadJS=this}).call({},this,document);